<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Product Master</title>

<style>
body{font-family:Arial;background:#f4f5f7;margin:0}
header{background:#fff;padding:16px;border-bottom:1px solid #ddd;font-size:20px;font-weight:600}
.container{display:flex;gap:20px;padding:20px}
.left{width:360px;background:#fff;padding:16px;border-radius:10px}
.right{flex:1;background:#fff;padding:16px;border-radius:10px}
input,textarea{width:100%;padding:9px;margin:6px 0 12px;border:1px solid #ccc;border-radius:6px}
button{background:#000;color:#fff;border:none;border-radius:6px;padding:8px 12px}
.product{padding:10px;border:1px solid #ddd;border-radius:8px;margin-bottom:10px}
</style>
</head>

<body>
<header>Product Master</header>

<div class="container">
<div class="left">
<h3 id="title">Add Product</h3>
<input id="code" placeholder="Product Code">
<input id="name" placeholder="Product Name">
<textarea id="desc" placeholder="Description"></textarea>
<input id="sizes" placeholder="Sizes (M,L,XL)">
<input id="price" placeholder="Price per PC">
<input id="gst" placeholder="GST %">
<input id="stock" placeholder="Physical Godown Stock (sets)">
<button onclick="save()">Save</button>
</div>

<div class="right" id="list">Loadingâ€¦</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbzmemqtHqusZH8IClo9QWFM0RGks6qEzBd10aUP44XU-ImZo146DCmP1n4v1cevjFyr/exec";
const supplierId=localStorage.getItem("supplierId")||"SUP1";

let data=[];
let editing=null;

function load(){
 fetch(API+`?action=getProductStockSummary&supplierId=${supplierId}`)
 .then(r=>r.json()).then(j=>{data=j.data; render();});
}
load();

function render(){
 list.innerHTML="";
 data.forEach(p=>{
   list.innerHTML+=`
    <div class="product">
      <b>${p.productCode}</b> - ${p.productName}<br>
      Sizes: ${p.sizes.join(", ")}<br>
      Physical: ${p.physical_stock}<br>
      Allocated: ${p.allocated_sets}<br>
      Allocatable: ${p.allocatable}<br>
      <button onclick="edit('${p.productCode}')">Edit</button>
    </div>`;
 });
}

function edit(code){
 const p=data.find(x=>x.productCode==code);
 editing=code;
 code.value=p.productCode;
 name.value=p.productName;
 desc.value=p.description||"";
 sizes.value=p.sizes.join(",");
 price.value=p.pricePerPC;
 gst.value=p.gstPercent;
 stock.value=p.physical_stock;
}

function save(){
 const payload=
 `&supplierId=${supplierId}`+
 `&productCode=${code.value}`+
 `&productName=${name.value}`+
 `&sizesJSON=${encodeURIComponent(JSON.stringify(sizes.value.split(",").map(s=>s.trim())))}`+
 `&pricePerPC=${price.value}`+
 `&gstPercent=${gst.value}`+
 `&physical_stock=${stock.value}`;

 const action=editing?"updateProduct":"addProduct";
 fetch(API+`?action=${action}${payload}`).then(load);
}
</script>
</body>
</html>
